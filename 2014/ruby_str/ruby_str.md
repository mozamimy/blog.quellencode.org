**Rubyにおける文字列リテラル**

Rubyには、文字列を表現するための方法が3種類ある。  
本題に入る前に、その3種の方法をおさらいしよう。

**ダブルクォーテーションを使うやりかた**

<pre class="brush: ruby">
str = "Alice" # => "Alice"
</pre>

サンプルコードでは、`str`というオブジェクトにAliceという文字列を格納している。  
ダブルクォーテーションを使う場合は、式展開できたり、エスケープ文字を扱うことができる。  

<pre class="brush :ruby">
name = "Alice"
str = "I am #{name}!\n" # => I am Alice!\n
</pre>

`#{}`の中括弧の中はRubyのコードとして実行され、返り値のオブジェクトの`to_s`メソッドを呼び出した結果に置換される（式展開）。  
また、改行文字（\n）やタブ文字（\t）なども含めることができる。

**シングルクォーテーションを使うやりかた**

<pre class="brush: ruby">
str = 'Alice'
</pre>

同じく、`str`にAliceという文字列を格納する例である。  
シングルクォーテーションを使う場合は式展開されないし、エスケープ文字で特殊な文字を表現することはできない。

<pre class="brush :ruby">
name = "Alice"
str = 'I am #{name}!\n' # => I'm #{name}!\\n
</pre>

**%記法を使うやりかた**

<pre class="brush: ruby">
alice = %!Alice! # => "Alice"
cheshire_cat = %Q[Cheshire Cat] # => "Cheshire Cat"
white_rabbit = %q[White Rabbit] # => "White Rabbit"
</pre>

%!!記法と%Q記法は、ダブルクォーテーションと同様の性質を持つ。つまり、式展開が可能でエスケープ文字が使える。  
一方%q記法は、シングルクォーテーションと同様の性質を持っている。

ちなみに、%Qおよび%q記法では、[]に限らず任意の文字を使うことができる。  
したがって以下のコードは正しい。

<pre class="brush: ruby">
queen_of_hearts = %Q*Queen of Hearts* # => "Queen of Hearts"
</pre>

**String#sub（String#gsub）と正規表現を使って置換する場合**

`String#sub`や`String#gsub`と正規表現を使って文字列を置換する場合、`\N`（Nは正の整数）を使うと、正規表現中のN番目のカッコにマッチした部分を再利用できる。

<pre class="brush: ruby">
"Alice found a bottle".gsub(/^(.+) found/, '\1 picked up')
    # => "Alice picked up a bottle"
</pre>

ダブルクォーテーションを使う場合、バックスラッシュがエスケープ文字の一部として認識されるため、以下のように書く必要がある。

<pre class="brush: ruby">
"Alice found a bottle".gsub(/^(.+) found/, "\\1 picked up")
    # => "Alice picked up a bottle"
</pre>

**結局どれを使えばいいの？**

本題である。  
紹介したように、Rubyには3種類の文字列リテラルの表現がある。  
わたしの知る限り、どれを使うのかは、Rubyプログラマの間でのコンセンサスのようなものはない。  

わたしは、*原則としてダブルクォーテーションを使い、例外的にシングルクォーテーション*を使う。%Qや%qは使わない。理由としては、

- 今式展開が不要だと思っていても、後から必要になることがある。いちいち書き換えるのが面倒。
- 感覚的に、ダブルクォーテーションの方が「文字列らしい」。  
  Cの影響を受けた言語の多くでは、シングルクォーテーションは文字リテラルを表現するために使われる。
- %Qや%q記法を積極的に使っているコードは、経験上希少である。  
  わざわざ普及していない記法をメインにしてもメリットがない。
  
などが挙げられる。

ただし、正規表現を使って置換する場合など、明らかにシングルクォーテーションの方が可読性が上がる場合は、シングルクォーテーションを使う。

**%Qや%qの使いドコロ**

以上の議論から、%Qおよび%qは使いどころがないように思える。  
現実、%Qや%qをモリモリ使っているコードは見たことがない。

ただし、以下のような場合には有用かもしれない。

- 何か特別な種類の文字列を表現する場合には%Qや%qを使う、というルールを決めて可読性を上げる場合
- DSLを設計するときに、内部的には文字列として扱いたいが、DSL上の表面的な意味としては普通の文字列と区別したい場合

もし、他に有用な使い方をご存知であれば、ぜひ教えてほしい。
